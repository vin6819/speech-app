FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive

# Install basic build tools and dependencies
RUN apt-get update && apt-get install -y \
    git curl wget build-essential cmake \
    python3 python3-pip python3-dev python-is-python3 \
    libtool automake autoconf zlib1g-dev \
    sox libsox-dev libsox-fmt-all \
    ffmpeg \
    && apt-get clean

# Optional: create a user to avoid root execution
RUN useradd -ms /bin/bash mfauser
USER mfauser
WORKDIR /home/mfauser

# Clone and install Kaldi (from Vosk repo â€” simpler)
RUN git clone --depth 1 --branch vosk --single-branch https://github.com/alphacep/kaldi.git \
    && cd kaldi/tools && make -j$(nproc) \
    && cd ../src && ./configure --shared && make -j$(nproc)

# Install MFA and kalpy
RUN pip install --upgrade pip \
    && pip install montreal-forced-aligner

# (Optional) Copy your script
# COPY your_script.py .

# Default command
CMD ["bash"]
